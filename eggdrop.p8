pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
--title
--author

function _init()
	game_over=false
	t=0
	g=2
	ground=114
	eggs={}
	make_player()
	pdir="r"
end

function _update()
 t+=1
	move_player()
 make_egg()
 for i=1,#eggs do
	 move_egg(eggs[i])
 end
end

function _draw()
	cls()
	draw_stage()
	draw_player()
	for i=1,#eggs do
	 draw_egg(eggs[i])
 end
	if(game_over) then
		print("game over",58,58,7)
		print("eggs:"..p.score,68,68,7)
	else
		print("eggs:"..p.score,1,1,7)
		print("t:"..t,0,10,7)
	end
end

function draw_stage()
 map(0,0,0,0,127,127,0)
end


function make_player()
	p = {}
	p.x=60
	p.y=112
	p.idle=1
	p.m1=2
	p.m2=3
	p.dead=4
 p.direction=r
	p.score=0
end

function move_player()
--0 left, 1 right, 2 up, 3 down
	if(btn(0)) then
	 pdir="l"
	 if(p.x>0) p.x-=2
 end
	if(btn(1)) then
	 pdir="r"
	 if(p.x<120) p.x+=2
 end
	--if(btn(2)) p.y-=2
	--if(btn(3)) p.y+=2
end

function draw_player()
 if(game_over) then
 	spr(p.dead,p.x,p.y)
 else
  if(pdir=="r") then
			spr(p.idle,p.x,p.y)
		else
		 spr(p.idle+4,p.x,p.y)
		end
	end
end

function make_egg()
	if(t%25==0) then
		xpos=flr(rnd(107))+10
		local e={}
		e.x=xpos
		e.y=-8
		e.sprite=32
		e.stage=0
		e.broken=false
		add(eggs,e)
	end
end

function move_egg(e)
 --make egg fall until it breaks
 if(e!=nil and e.y<112) then
  e.y+=g
  --collect unbroken egg
  --egg at right y?
  if(e.y+7>=p.y) then
   --egg at right x?
   --[e][c] and [c][e]
   if(e.x+6 >= p.x and p.x+8 >= e.x) then 
    del(eggs,e)
    p.score+=1
    sfx(5,1)
   end
  end
	else
  if(e!=nil and e.broken==false) then
   e.broken=true
   sfx(06,2)
  end
 end
end

function draw_egg(e)
 if(e!=nil) then
  if(e.y<112) then
		 spr(e.sprite,e.x,e.y)
		else
		 e.stage+=1
		 if(e!=nil and e.stage>35) then
		  del(eggs,e)
		 elseif(e.stage>25) then
		  spr(e.sprite+6,e.x,e.y)
		 elseif(e.stage>15) then
		  spr(e.sprite+5,e.x,e.y)
		 elseif(e.stage>4) then
		  spr(e.sprite+4,e.x,e.y)
		 elseif(e.stage>3) then
		  spr(e.sprite+3,e.x,e.y)
		 elseif(e.stage>2) then
		  spr(e.sprite+2,e.x,e.y)
	  elseif(e.stage>0) then
		  spr(e.sprite+1,e.x,e.y)
	  end
  end
	end
end
__gfx__
00000000000088000000880000008800000000000088000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000075700000757000007570000088000757000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000077990000779900007799000075709977000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000777777807777778077777780000077990877777700000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000777777707777777077777770777777800777777700000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700777777707777777077777770777777700777777700000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777700777777007777770777777700777777000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000a0a0000000a00000a00000777777000a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333331111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333331111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
34333333333333331111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
34433443333433341111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444441111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444441111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444441111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444441111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777700007777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777700007779000077790000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770077779970777990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770077797770777999007779990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770077977777779779777997997000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777700009997709999997997999979079997900099970000099000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110111110101111101110111110101100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
01140000181101870018700181001810018100181001870018100187001810018700187001870018700187001810018700181001870018100187001d5001f5001f50000000000000000000000000000000000000
0114000021520215202352024520245202452530700267002352023520215201f5201f5201f52500000185001f5201f520215201a5201a520185201a5201a5201c52018520185201852518700000000000000000
011000001c5201c5201c5201c5201c5201c5201c5201c5251a5201a5201a5201a5201a5201a5201a520185201852018520185201852018520185251d5001d5001d5001d5001d5001d5001d5001d5000000000000
011000001d5201d5201d5201d5201d5201d5201d5201d5251c5201c5201c5201c5201c5201c5201c5201c5251f5201f5201f5201f5201f5201f52518500185001850018500185001850018500000000000000000
011000001c5201c5201c5201c5201c5201c5201c5201c5251f5201f5201f5201f5201f5201f5201f5201f52518520185201852018520185201852500000000000000000000000000000000000000000000000000
010a0000340511830018400185001860018700180001a00024000181001a100000002d0002f0002d0002f0002f000300002f00030000000000000000000000000000000000000000000000000000000000000000
010800003074330100301003020030300303003040030200305003050030400303003020030100300003000030600306003060030600306003060030600306003060030600306003060030600306000000000000
__music__
01 02404244
00 03404344
02 04404344
00 40424344

