pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
--chickenegg
--shwenhog

--todo neaten global variables
------ add menu screen
------ add high score board (local)
------ add bombs
------ add different game modes (timed, lives+bombs)
state = {}
state.time = 0
state.gravity = 2
state.eggs = {}
state.timeup = 1800

--Egg sprite is y1-y7; x1-x6
--Ground sprite is 8x8
boundary = {}
boundary.left = 7
boundary.right = 119
boundary.top = -8
boundary.bottom = 112

sprite = {}
sprite.player = 1
sprite.egg = 32
sprite.eggLR = 1

player = {}
player.x = 60
player.y = 112
player.direction = right
player.score = 0
player.sprt = sprite.player
player.flip = false

function _init()
end

function _update()
  if( state.time <= state.timeup ) then
    state.time += 1
    state.gravity += 0.001
    movePlayer()
    handleEggs()
  end
end

function _draw()
  cls()
  drawStage()
  spr(player.sprt, player.x, player.y, 1, 1, player.flip)
  foreach(state.eggs, drawEgg)
  if( state.time <= state.timeup ) then
    print("eggs:"..player.score,1,1,7)
    print("t:"..state.time,0,10,7)
  else
    --Each char is 4w 6h
    cls()
    drawStage()
    spr(player.sprt, player.x, player.y, 1, 1, player.flip)
    print("time's up!", (127/2 - 10*2), (127/2 - 6*2))
    print("you collected", (127/2 - 13*2), (127/2 - 6))
    print(player.score.." eggs", (127/2 - 7*2), (127/2))
  end
end

function drawMenu()


function drawStage()
  map(0,0,0,0,127,127,0)
end

function spriteAnimator(n)
  local i = 0
  i += n
  return i
end

function movePlayer()
  --btn0 is left, btn1 is right
  if( btn(0) ) then
    player.flip = true
    player.x -= 2
    player.sprt += spriteAnimator(1)
    if( player.sprt > 3 ) then
      player.sprt = 2
    end
  elseif( btn(1) ) then
    player.flip = false
    player.x += 2
    player.sprt += spriteAnimator(1)
    if( player.sprt > 3 ) then
      player.sprt = 2
    end
  else
    player.sprt = 1
  end
end

function handleEggs()
  makeEgg() --Try and make a new egg
  foreach(state.eggs, moveEgg) --Move eggs
 end

function makeEgg()
  if( state.time%25 == 0 ) then
    rndX = flr( rnd(boundary.right-boundary.left) + boundary.left )
    local newEgg = {}
    newEgg.x = rndX
    newEgg.y = boundary.top
    newEgg.sprt = sprite.egg
    newEgg.timer = 0
    newEgg.broken = false
    add(state.eggs, newEgg)
  end
end

function moveEgg(egg)
  --Egg falls until it reaches the ground
  if( egg.y < boundary.bottom ) then
    egg.y += state.gravity
    --Check if player can collect egg
    local lowY = egg.y + 7
    local lowX = egg.x + sprite.eggLR
    local highX = egg.x + (7-sprite.eggLR)

    if( (player.y <= lowY) and (player.x+7 >= lowX) and (player.x <= highX) ) then
      del(state.eggs, egg)
      sfx(5,2)
      player.score += 1
    end
  elseif( egg.broken == false ) then
    egg.broken = true
    sfx(6,3)
  end
end

function drawEgg(egg)
  if( egg.y < boundary.bottom ) then
    spr(egg.sprt, egg.x, egg.y)
  else
    egg.sprt += spriteAnimator(1)
    if( egg.sprt >= 38 ) then
      del(state.eggs, egg)
    else
      spr(egg.sprt, egg.x, egg.y)
    end
  end
end


-->8
--new tabe test
__gfx__
00000000000088000000880000008800000000000088000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000075700000757000007570000088000757000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000077990000779900007799000075709977000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000777777807777778077777780000077990877777700000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000777777707777777077777770777777800777777700000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700777777707777777077777770777777700777777700000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777700777777007777770777777700777777000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000a0a0000000a00000a00000777777000a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333331111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333331111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
34333333333333331111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
34433443333433341111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444441111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444441111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444441111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444441111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777700007777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777700007779000077790000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770077779970777990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770077797770777999007779990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770077977777779779777997997000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777700009997709999997997999979079997900099970000099000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110111110101111101110111110101100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
01140000181101870018700181001810018100181001870018100187001810018700187001870018700187001810018700181001870018100187001d5001f5001f50000000000000000000000000000000000000
0114000021520215202352024520245202452530700267002352023520215201f5201f5201f52500000185001f5201f520215201a5201a520185201a5201a5201c52018520185201852518700000000000000000
011000001c5201c5201c5201c5201c5201c5201c5201c5251a5201a5201a5201a5201a5201a5201a520185201852018520185201852018520185251d5001d5001d5001d5001d5001d5001d5001d5000000000000
011000001d5201d5201d5201d5201d5201d5201d5201d5251c5201c5201c5201c5201c5201c5201c5201c5251f5201f5201f5201f5201f5201f52518500185001850018500185001850018500000000000000000
011000001c5201c5201c5201c5201c5201c5201c5201c5251f5201f5201f5201f5201f5201f5201f5201f52518520185201852018520185201852500000000000000000000000000000000000000000000000000
010a0000340511830018400185001860018700180001a00024000181001a100000002d0002f0002d0002f0002f000300002f00030000000000000000000000000000000000000000000000000000000000000000
010800003074330100301003020030300303003040030200305003050030400303003020030100300003000030600306003060030600306003060030600306003060030600306003060030600306000000000000
__music__
01 02404244
00 03404344
02 04404344
00 40424344

